
<nav class="col col-lg-12 text-left">
  <div class="card-body">
      <h2 class="text-success">Administración</h2>
  </div>
  <ol _ngcontent-egs-c125="" class="breadcrumb">
    <li aria-current="page" class="breadcrumb-item">
      <a routerlink="/inicio" ng-reflect-router-link="/inicio" href="#/inicio"
        >Inicio</a
      >
    </li>
    <li aria-current="page" class="breadcrumb-item active"> Generar Contrato </li>
  </ol>
</nav>

<form [formGroup] = "formContrato" (onsubmit)="sendFormularioContrato()">
  <div class="mat-elevation-z8 w-10 mx-auto  bg-body-secondary"  >
  <h2 class="w-full flex text-center bg-blue fs-3 text-white h-4rem justify-content-center align-items-center"> Generar Contrato</h2>
  <div class="d-flex justify-content-end">
    <mat-form-field  class="mt-2 ml-3 w-3">
      <mat-label> Numero </mat-label>
      <input type="text" matInput placeholder="Numero" />
    </mat-form-field>

    <mat-form-field class="mt-2 ml-3 w-3 mr-4 ">
      <mat-label>Tipo de Contrato</mat-label>
      <mat-select (valueChange)="recalcular($event , 'select')" formControlName="selected_tipo_Contrato" #tipoContrat  >
        <mat-option *ngFor= "let tipo of tipoContrato"   [value]= "tipo.valorUnitario"  >
          {{ tipo.nombre }}
        </mat-option>
      </mat-select>
    </mat-form-field>
  </div>

    <div class=" d-flex justify-content-end">
      <mat-form-field class="mt-2 ml-2 w-2 ml-4 ">
        <mat-label>Provincia</mat-label>
        <mat-select (valueChange)="cargaCantones($event)">
          <mat-option *ngFor="let prov of provincias" [value]="prov.value">
            {{ prov.viewValue }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field class="mt-2 ml-3 w-2">
        <mat-label>Canton</mat-label>
        <mat-select (valueChange)="cargarParroquias($event)">
          <mat-option *ngFor="let canton of cantones" [value]="canton.value">
            {{ canton.viewValue }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field class="mt-2 ml-3 w-2 ">
        <mat-label>Parroquia</mat-label>
        <mat-select>
          <mat-option
            *ngFor="let parroquia of parroquias"
            [value]="parroquia.value" >
            {{ parroquia.viewValue }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field class="w-2 ml-3 mt-2 ">
        <mat-label>Sector</mat-label>
        <input type="text" matInput placeholder="Sector"  />
      </mat-form-field>

      <mat-form-field class="w-3 ml-3 mt-2 mr-4">
        <mat-label>Direccion</mat-label>
        <input type="text" matInput placeholder="Direccion"  />
      </mat-form-field>


    </div>

    <div class="d-flex justify-content-end">
      <mat-form-field class="mt-2 ml-3 w-3">
        <mat-label>Fecha de Inicio</mat-label>
        <input matInput [matDatepicker]="picker" formControlName = "fechaVigente" (dateChange)="retornarFecha($event.value)"  />
        <mat-hint>MM/DD/YYYY</mat-hint>
        <mat-datepicker-toggle
          matIconSuffix
          [for]="picker"
        ></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>

      <mat-form-field class="mt-2 ml-3 w-3 mr-4">
        <mat-label>Fecha de Firma</mat-label>
        <input matInput [matDatepicker]="picker3" />
        <mat-hint>MM/DD/YYYY</mat-hint>
        <mat-datepicker-toggle
          matIconSuffix
          [for]="picker3"
        ></mat-datepicker-toggle>
        <mat-datepicker #picker3></mat-datepicker>
      </mat-form-field>

      <mat-form-field class="mt-2 ml-3 w-3 mr-4">
        <mat-label>Numero de Meses</mat-label>
        <input  type="number" matInput placeholder="numero de días" formControlName="mesesContrato" #mesesContrato (input)="calcularFecha(mesesContrato.valueAsNumber)" />
      </mat-form-field>


    </div>

    <div class="mt-3 flex justify-content-end">
    
      <mat-form-field class="w-2 m-2">
        <mat-label>Cantidad</mat-label>
        <input type="number" matInput placeholder="Cantidad" formControlName="valCantidad" (input)="recalcular(tipoContrat.value ,'')" />
      </mat-form-field>

      <mat-form-field class="w-3 m-2 mr-4">
        <mat-label>Observación</mat-label>
        <input type="text" matInput placeholder="Observación"  />
      </mat-form-field>
    </div>

    <div class=" flex justify-content-end ">

      <span class="m-2 mt-3 w-4" >
      <mat-checkbox  color="primary">
          <span class="tamanio" >Estado de Verificación</span>
      </mat-checkbox>
      </span>
  
      <mat-form-field class="w-3 m-2">
        <mat-label  >Cantidad Verificada</mat-label>
        <input type="number" matInput placeholder="Cantidad Verificada" />
      </mat-form-field>

      <!-- <mat-form-field class="w-3 m-2 mr-4 "> -->
        <mat-label class="w-3 mt-4 mr-4 fs-2 text-center" >{{total | currency: 'USD' }}</mat-label>
        <!-- <input type="number" matInput placeholder="Valor Total" formControlName = "valorTotal" readonly="true"  />
      </mat-form-field> -->

    </div>

    <div class="d-flex justify-content-end mr-4">
        <button  type="submit" class="ml-2 btn-naranja mb-4 btn-color"  mat-button mat-flat-button color="primary">
          <mat-icon>gavel</mat-icon>
          Guardar Contrato
        </button>

        <button  type="submit" class="ml-4 btn-naranja mb-4 btn-color"  mat-button mat-flat-button color="primary">
          <mat-icon>verified</mat-icon>
          Verificar Contrato
        </button>

    </div>


  </div>
</form>

<!-- TODO: MOSTRAR CALCULOS DEL CONTRATO -->

<div class="w-10 mx-auto mt-5">
  <table mat-table  [dataSource]="dataSource"  > 
    
    <ng-container matColumnDef="vigencia">
      <th mat-header-cell *matHeaderCellDef >VIGENCIA</th>
      <td mat-cell  *matCellDef="let element" class="fs-6">{{ element.vigencia }}</td>
    </ng-container>

    <ng-container matColumnDef="ubicacion">
      <th mat-header-cell   *matHeaderCellDef>UBICACION</th>
      <td mat-cell  *matCellDef="let element" class="fs-6">{{ element.ubicacion }}</td>
    </ng-container>

    <ng-container matColumnDef="cantidad">
      <th mat-header-cell   *matHeaderCellDef>CANTIDAD/LONGITUD</th>
      <td mat-cell  *matCellDef="let element" class="fs-5">{{ element.cantidad }}</td>
    </ng-container>

    <ng-container matColumnDef="subTotal">
      <th mat-header-cell   *matHeaderCellDef >SUBTOTAL </th>
      <td mat-cell  *matCellDef="let element" class="fs-4">{{ element.subTotal | currency: 'USD' }}</td>
    </ng-container>

    <ng-container matColumnDef="valor">
      <th mat-header-cell   *matHeaderCellDef >VALOR TOTAL </th>
      <td mat-cell  *matCellDef="let element" class="fs-4">{{ element.valor | currency: 'USD' }}</td>
    </ng-container>

    <ng-container matColumnDef="tipoContrato">
      <th mat-header-cell   *matHeaderCellDef>Tipo Contrato </th>
      <td mat-cell  *matCellDef="let element" class="fs-6">{{ element.tipoContrato }}</td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumnss"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumnss"></tr>

  </table> 

</div>


